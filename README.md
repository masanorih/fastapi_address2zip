# 住所→郵便番号変換API

日本の住所文字列から7桁郵便番号を取得する FastAPI WebAPI システム

## 特徴

- **高精度変換**: 住所正規化 + 階層インデックス検索
- **高速応答**: O(1)アルゴリズムで1ms未満の高速応答
- **段階的検索**: 完全一致→部分一致→汎用フォールバックの多段階検索
- **Webインターフェース**: サンプルアプリケーション付き
- **高品質**: 65テストケースによる包括的品質保証

## 前提条件

### 必須データファイル

このアプリケーションの動作には **ken_all.csv** ファイルが必要です。

- **ファイル名**: `ken_all.csv`
- **配置場所**: プロジェクトルートディレクトリ
- **入手先**: [日本郵便 郵便番号ダウンロード](https://www.post.japanpost.jp/zipcode/download.html)

**重要**: このファイルはリポジトリに含まれていません。上記URLから最新版をダウンロードし、UTF-8エンコーディングで保存してください。

## クイックスタート

### 1. 依存関係インストール
```bash
uv sync
```

### 2. データファイル準備
```bash
# 日本郵便から ken_all.csv をダウンロードし、プロジェクトルートに配置
# https://www.post.japanpost.jp/zipcode/download.html
```

### 3. サーバー起動
```bash
uv run python main.py
```

### 4. Webサンプルアクセス
http://localhost:8000 でWebインターフェースを確認

### 5. API呼び出し
```bash
curl -X POST "http://localhost:8000/address2zipcode" \
  -H "Content-Type: application/json" \
  -d '{"address": "東京都港区六本木5丁目"}'
```

**レスポンス:**
```json
{
  "zipcode": "1060032",
  "original_address": "東京都港区六本木5丁目",
  "normalized_address": "東京都港区六本木5丁目"
}
```

## 住所検索例

### 基本住所
- `東京都港区六本木5丁目` → `1060032`
- `東京都千代田区神田小川町3-22-16` → `1010052`

### 政令指定都市
- `大阪府大阪市北区梅田1丁目` → `5300001`

### 札幌特殊住所
- `北海道札幌市中央区北1条西1丁目` → `0600001`
- `北海道札幌市中央区北一条西一丁目` → `0600001`

### 正規化機能
- 全角数字 → 半角数字: `５丁目` → `5丁目`
- 漢数字 → 算用数字: `五丁目` → `5丁目`
- 建物名除去: `六本木ヒルズ` → `六本木`
- 番地除去: `3-22-16` → 自動除去

## APIエンドポイント

### エンドポイント一覧

| メソッド | パス | 機能 |
|---------|------|------|
| GET | `/` | サンプルWebアプリケーション |
| POST | `/address2zipcode` | 住所→郵便番号変換 |
| GET | `/health` | ヘルスチェック |

### ステータスコード

| コード | 意味 |
|--------|------|
| 200 | 成功変換 |
| 404 | 住所見つからず |
| 422 | リクエスト形式エラー |
| 500 | 内部エラー |

## 開発

### テスト実行
```bash
uv run pytest test/ -v  # 全テスト実行（65ケース、1.1秒）
```

**注意**: ken_all.csvが存在しない場合、一部のテストはスキップされます。完全なテスト実行には上記データファイルが必要です。

### 関連ドキュメント
詳細な技術仕様は以下を参照：
- `ARCHITECTURE.md` - 技術アーキテクチャ詳細
- `address_to_zipcode_strategy.md` - 設計戦略文書
- `CLAUDE.md` - 開発ガイドライン

### プロジェクト構造
```
├── main.py                    # FastAPI アプリケーション
├── address_normalizer.py      # 住所正規化機能
├── address_resolver.py        # 住所→郵便番号解決
├── ken_all.csv                # 日本郵便データ（要ダウンロード）
├── templates/
│   └── index.html            # Webインターフェース
└── test/                      # テストスイート
```

## 技術仕様

- **Python 3.11+**
- **FastAPI** - Web API フレームワーク
- **uvicorn** - ASGI サーバー
- **pytest** - テストフレームワーク
- **uv** - パッケージ管理

## ライセンス

このプロジェクトは [MIT License](./LICENSE) の下で公開されています。

### 使用可能な範囲
- ✅ 商用利用
- ✅ 修正・改変
- ✅ 配布・再配布  
- ✅ プライベート利用

詳細は [LICENSE](./LICENSE) ファイルをご確認ください。
